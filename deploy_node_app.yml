- name: Setup default variables
  set_fact: app_path=/opt/{{ app_name }}

- name: Make app dir
  file: path={{ app_path }} state=directory mode=0755 owner=vagrant group=vagrant

- name: Pull sources from the repository
  sudo: no
  git: repo={{ git_repo }} dest={{ app_path }} force=yes version=master

- name: Install npm packages
  sudo: no
  npm: path={{ app_path }}

- name: Install systemd start/stop script
  template: src=templates/node_app_systemd_script.j2 dest=/etc/systemd/system/{{ app_name }}.service owner=root group=root mode=0644

- name: (Re)Start service
  service: name={{ app_name }} state=restarted enabled=yes